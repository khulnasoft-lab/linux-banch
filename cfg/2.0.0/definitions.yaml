---
version: 2.0.0
id: 1
description: Account Policies
type: domain-controller
groups:
  - id: 1.1
    description: Password Policy
    checks:
      - id: 1.1.1
        description: Ensure 'Enforce password history' is set to '24 or more
          password(s)' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
              Select -ExpandProperty PasswordHistoryCount
            MemberServer: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer | Select
              -ExpandProperty PasswordHistoryCount
        tests:
          test_items:
            - flag: ""
              compare:
                op: gte
                value: 24
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the
          following UI path to 24 or more password(s):
            Computer Configuration\Policies\Windows Settings\Security Settings\Account
            Policies\Password Policy\Enforce password history
        scored: true
      - id: 1.1.2
        description: Ensure 'Maximum password age' is set to '365 or fewer days, but not
          0' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
              Select -ExpandProperty MaxPasswordAge | Select -ExpandProperty
              TotalDays
            MemberServer: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer | Select
              -ExpandProperty MaxPasswordAge | Select -ExpandProperty TotalDays
        tests:
          bin_op: and
          test_items:
            - flag: ""
              compare:
                op: lte
                value: 365
              set: true
            - flag: ""
              compare:
                op: noteq
                value: 0
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the
          following UI path to 365 or fewer days, but not 0:
           Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Password Policy\Maximum password age
        scored: true
      - id: 1.1.3
        description: Ensure 'Minimum password age' is set to '1 or more day(s)' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
              Select -ExpandProperty MinPasswordAge | Select -ExpandProperty
              TotalDays
            MemberServer: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer | Select
              -ExpandProperty MinPasswordAge | Select -ExpandProperty TotalDays
        tests:
          test_items:
            - flag: ""
              compare:
                op: gte
                value: 1
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the
          following UI path to 1 or more day(s):
             Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Password Policy\Minimum password age
        scored: true
      - id: 1.1.4
        description: Ensure 'Minimum password length' is set to '14 or more
          character(s)' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
              Select -ExpandProperty MinPasswordLength
            MemberServer: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer | Select
              -ExpandProperty MinPasswordLength
        tests:
          test_items:
            - flag: ""
              compare:
                op: gte
                value: 14
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the
          following UI path to 14 or more character(s):
              Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Password Policy\Minimum password length
        scored: true
      - id: 1.1.5
        description: Ensure 'Password must meet complexity requirements' is set to
          'Enabled' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
              Select -ExpandProperty ComplexityEnabled
            MemberServer: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer | Select
              -ExpandProperty ComplexityEnabled
        tests:
          test_items:
            - flag: ""
              compare:
                op: has
                value: "True"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the
          following UI path to 14 or more character(s):
               Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Password Policy\Password must meet complexity requirements
        scored: true
      - id: 1.1.6
        description: Ensure 'Relax minimum password length limits' is set to 'Enabled'
          (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemProperty -Path HKLM:\System\CurrentControlSet\Control\SAM\RelaxMinimumPasswordLengthLimits
            MemberServer: Get-ItemProperty -Path HKLM:\System\CurrentControlSet\Control\SAM\RelaxMinimumPasswordLengthLimits
        tests:
          test_items:
            - flag: ""
              compare:
                op: has
                value: "True"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the
          following UI path to Enabled:
               Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Password Policy\Relax minimum password length limits
        scored: true
      - id: 1.1.7
        description: Ensure 'Store passwords using reversible encryption' is set to
          'Disabled'
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
              Select -ExpandProperty ReversibleEncryptionEnabled
            MemberServer: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer | Select
              -ExpandProperty ReversibleEncryptionEnabled
        tests:
          test_items:
            - flag: ""
              compare:
                op: has
                value: "False"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the
          following UI path to Disabled:
                Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Password Policy\Store passwords using reversible encryption
        scored: true
  - id: 1.2
    description: Account Lockout Policy
    checks:
      - id: 1.2.1
        description: Ensure 'Account lockout duration' is set to '15 or more minute(s)' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
               Select -ExpandProperty LockoutDuration | Select -ExpandProperty Minutes
            MemberServer: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
               Select -ExpandProperty LockoutDuration | Select -ExpandProperty Minutes
        tests:
          test_items:
            - flag: ""
              compare:
                op: gte
                value: 15
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 15 or more minute(s):
             Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Account Lockout Policy\Account lockout duration
        scored: true
      - id: 1.2.2
        description: Ensure 'Account lockout threshold' is set to '5 or fewer invalid logon attempt(s), but not 0' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
               Select -ExpandProperty LockoutThreshold
            MemberServer: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
               Select -ExpandProperty LockoutThreshold
        tests:
          test_items:
            - flag: ""
              compare:
                op: lte
                value: 5
              set: true
            - flag: ""
              compare:
                op: noteq
                value: 0
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 5 or fewer invalid login attempt(s), but not 0:
              Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Account Lockout Policy\Account lockout threshold
        scored: true
      - id: 1.2.3
        description: Ensure 'Allow Administrator account lockout' is set to 'Enabled' (Manual)
        type: manual
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 15 or more minute(s):
              Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Account Lockout Policies\Allow Administrator account lockout
        scored: true

      - id: 1.2.4
        description: Ensure 'Reset account lockout counter after' is set to '15 or more minute(s)' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
              Select -ExpandProperty LockoutObservationWindow | Select -ExpandProperty Minutes
            MemberServer: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
              Select -ExpandProperty LockoutObservationWindow | Select -ExpandProperty Minutes
        tests:
          test_items:
            - flag: ""
              compare:
                op: gte
                value: 15
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 15 or more minute(s):
              Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Account Lockout Policy\Reset account lockout counter after
        scored: true
  - id: 2.2
    description: User Rights Assignment
    checks:
      - id: 2.2.1
        description: Ensure 'Access Credential Manager as a trusted caller' is set to 'No One' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: SecEdit /export /cfg seccfg /areas USER_RIGHTS /quiet ; Get-Content seccfg | Select-String -Pattern "SeTrustedCredManAccessPrivilege" ; Remove-Item seccfg
            MemberServer: SecEdit /export /cfg seccfg /areas USER_RIGHTS /quiet ; Get-Content seccfg | Select-String -Pattern "SeTrustedCredManAccessPrivilege" ; Remove-Item seccfg
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: ""
              set: true

        remediation: >
          To establish the recommended configuration via GP, set the following UI path to "No One":
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\Access Credential Manager as a trusted caller
        scored: true
      - id: 2.2.2
        description: Ensure 'Access this computer from the network' is set to 'Administrators, Authenticated Users, ENTERPRISE DOMAIN CONTROLLERS' (DC only) (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: SecEdit /export /cfg seccfg /areas USER_RIGHTS /quiet ; (Get-Content seccfg | Select-String -Pattern "SeNetworkLogonRight") -replace '^.*= |[*]' ; Remove-Item seccfg
        tests:
          test_items:
            - flag: ""
              compare:
                op: valid_elements
                value: "S-1-5-32-544,S-1-5-11,S-1-5-9"
              set: true
        remediation: >
          To establish the recommended configuration via GP, configure the following UI path:
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\Access this computer from the network
        scored: true
      - id: 2.2.3
        description: Ensure 'Access this computer from the network' is set to 'Administrators, Authenticated Users' (MS only) (Automated)
        audittype: powershell
        audit:
          cmd:
            MemberServer: SecEdit /export /cfg seccfg /areas USER_RIGHTS /quiet ; (Get-Content seccfg | Select-String -Pattern "SeNetworkLogonRight") -replace '^.*= |[*]' ; Remove-Item seccfg
        tests:
          test_items:
            - flag: ""
              compare:
                op: valid_elements
                value: "S-1-5-32-544,S-1-5-11"
              set: true

        remediation: >
          To establish the recommended configuration via GP, configure the following UI path:
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\Access this computer from the network
        scored: true
      - id: 2.2.4
        description: Ensure 'Act as part of the operating system' is set to 'No One' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: SecEdit /export /cfg seccfg /areas USER_RIGHTS /quiet ; Get-Content seccfg | Select-String -Pattern "SeTcbPrivilege" ; Remove-Item seccfg
            MemberServer: SecEdit /export /cfg seccfg /areas USER_RIGHTS /quiet ; Get-Content seccfg | Select-String -Pattern "SeTcbPrivilege" ; Remove-Item seccfg
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: ""
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to "No One":
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\Act as part of the operating system
        scored: true
      - id: 2.2.5
        description: Ensure 'Add workstations to domain' is set to 'Administrators' (DC only) (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: SecEdit /export /cfg seccfg /areas USER_RIGHTS /quiet ; (Get-Content seccfg | Select-String -Pattern "SeMachineAccountPrivilege") -replace '^.*= |[*]' ; Remove-Item seccfg
        tests:
          test_items:
            - flag: ""
              compare:
                op: valid_elements
                value: "S-1-5-32-544"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to Administrators:
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\Add workstations to domain
        scored: true
  - id: 2.3
    description: Security Options
    checks:
      - id: 2.3.1.1
        description: Ensure 'Block Microsoft accounts' is set to 'Users can't add or log on with Microsoft accounts' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' noconnecteduser
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' noconnecteduser
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "3"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Users can't add or log on with Microsoft accounts':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Accounts: Block Microsoft accounts
        scored: true
      - id: 2.3.1.2
        description: Ensure 'Guest account status' is set to 'Disabled' (MS only) (Automated)
        audittype: powershell
        audit:
          cmd:
            MemberServer: SecEdit /export /cfg seccfg /areas SecurityPolicy /quiet ; (Get-Content seccfg | Select-String -Pattern "EnableGuestAccount") -replace '^.*= |[*]' ; Remove-Item seccfg
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Accounts: Guest account status
        scored: true
      - id: 2.3.1.3
        description: Ensure 'Limit local account use of blank passwords to console logon only' is set to 'Enabled' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Control\Lsa' LimitBlankPasswordUse
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Control\Lsa' LimitBlankPasswordUse
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Accounts: Limit local account use of blank passwords to console logon only
        scored: true
      - id: 2.3.1.4
        description: Configure 'Rename administrator account' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: SecEdit /export /cfg seccfg /areas SecurityPolicy /quiet ; (Get-Content seccfg | Select-String -Pattern "NewAdministratorName") -replace '.*"([^"]+)".*','$1' ; Remove-Item seccfg
            MemberServer: SecEdit /export /cfg seccfg /areas SecurityPolicy /quiet ; (Get-Content seccfg | Select-String -Pattern "NewAdministratorName") -replace '.*"([^"]+)".*','$1' ; Remove-Item seccfg
        tests:
          test_items:
            - flag: ""
              compare:
                op: noteq
                value: "Administrator"
              set: true
        remediation: >
          To establish the recommended configuration via GP, configure the following UI path:
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Accounts: Rename administrator account
        scored: true
      - id: 2.3.1.5
        description: Configure 'Rename guest account' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: SecEdit /export /cfg seccfg /areas SecurityPolicy /quiet ; (Get-Content seccfg | Select-String -Pattern "NewGuestName") -replace '.*"([^"]+)".*','$1' ; Remove-Item seccfg
            MemberServer: SecEdit /export /cfg seccfg /areas SecurityPolicy /quiet ; (Get-Content seccfg | Select-String -Pattern "NewGuestName") -replace '.*"([^"]+)".*','$1' ; Remove-Item seccfg
        tests:
          test_items:
            - flag: ""
              compare:
                op: noteq
                value: "Guest"
              set: true
        remediation: >
          To establish the recommended configuration via GP, configure the following UI path:
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Accounts: Rename guest account
        scored: true
      - id: 2.3.2.1
        description: "Ensure 'Audit: Force audit policy subcategory settings (Windows Vista or later) to override audit policy category settings' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\System\CurrentControlSet\Control\Lsa' SCENoApplyLegacyAuditPolicy
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Control\Lsa' SCENoApplyLegacyAuditPolicy
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Audit: Force audit policy subcategory settings (Windows Vista or later) to override audit policy category settings
        scored: true
      - id: 2.3.2.2
        description: "Ensure 'Audit: Shut down system immediately if unable to log security audits' is set to 'Disabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\System\CurrentControlSet\Control\Lsa' CrashOnAuditFail
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Control\Lsa' CrashOnAuditFail
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Audit: Shut down system immediately if unable to log security audits
        scored: true
      - id: 2.3.4.1
        description: "Ensure 'Devices: Allowed to format and eject removable media' is set to 'Administrators' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon' AllocateDASD
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon' AllocateDASD
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Administrators':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Devices: Allowed to format and eject removable media
        scored: true
      - id: 2.3.4.2
        description: "Ensure 'Devices: Prevent users from installing printer drivers' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Control\Print\Providers\LanMan Print Services\Servers' AddPrinterDrivers
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Control\Print\Providers\LanMan Print Services\Servers' AddPrinterDrivers
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Devices: Prevent users from installing printer drivers
        scored: true
      - id: 2.3.5.1
        description: "Ensure 'Domain controller: Allow server operators to schedule tasks' is set to 'Disabled' (DC only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\System\CurrentControlSet\Control\Lsa' SubmitControl
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Domain controller: Allow server operators to schedule tasks
        scored: true
      - id: 2.3.5.2
        description: "Ensure 'Domain controller: Allow vulnerable Netlogon secure channel connections' is set to 'Not Configured' (DC Only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\System\CurrentControlSet\Services\Netlogon\Parameters' VulnerableChannelAllowList
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: ""
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Not Configured':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Domain controller: Allow vulnerable Netlogon secure channel connections
        scored: true
      - id: 2.3.5.3
        description: "Ensure 'Domain controller: LDAP server channel binding token requirements' is set to 'Always' (DC Only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\NTDS\Parameters' LdapEnforceChannelBinding
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "2"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Always':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Domain controller: LDAP server channel binding token requirements
        scored: true
      - id: 2.3.5.4
        description: "Ensure 'Domain controller: LDAP server signing requirements' is set to 'Require signing' (DC only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\NTDS\Parameters' LDAPServerIntegrity
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "2"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Require signing':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Domain controller: LDAP server signing requirements
        scored: true
      - id: 2.3.5.5
        description: "Ensure 'Domain controller: Refuse machine account password changes' is set to 'Disabled' (DC only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters' RefusePasswordChange
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Domain controller: Refuse machine account password changes
        scored: true
      - id: 2.3.6.1
        description: "Ensure 'Domain member: Digitally encrypt or sign secure channel data (always)' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters' RequireSignOrSeal
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters' RequireSignOrSeal
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Domain member: Digitally encrypt or sign secure channel data (always)
        scored: true
      - id: 2.3.6.2
        description: "Ensure 'Domain member: Digitally encrypt secure channel data (when possible)' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters' SealSecureChannel
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters' SealSecureChannel
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Domain member: Digitally encrypt secure channel data (when possible)
        scored: true
      - id: 2.3.6.3
        description: "Ensure 'Domain member: Digitally sign secure channel data (when possible)' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters' SignSecureChannel
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters' SignSecureChannel
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Domain member: Digitally sign secure channel data (when possible)
        scored: true
      - id: 2.3.6.4
        description: "Ensure 'Domain member: Disable machine account password changes' is set to 'Disabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters' DisablePasswordChange
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters' DisablePasswordChange
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Domain member: Disable machine account password changes
        scored: true
      - id: 2.3.6.5
        description: "Ensure 'Domain member: Maximum machine account password age' is set to '30 or fewer days, but not 0' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters' MaximumPasswordAge
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters' MaximumPasswordAge
        tests:
          test_items:
            - flag: ""
              compare:
                op: lte
                value: 30
              set: true
            - flag: ""
              compare:
                op: noteq
                value: 0
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 30 or fewer days, but not 0:
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Domain member: Maximum machine account password age
        scored: true
      - id: 2.3.6.6
        description: "Ensure 'Domain member: Require strong (Windows 2000 or later) session key' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters' RequireStrongKey
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters' RequireStrongKey
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Domain member: Require strong (Windows 2000 or later) session key
        scored: true
      - id: 2.3.7.1
        description: "Ensure 'Interactive logon: Do not require CTRL+ALT+DEL' is set to 'Disabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' DisableCAD
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' DisableCAD
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Interactive logon: Do not require CTRL+ALT+DEL
        scored: true
      - id: 2.3.7.2
        description: "Ensure 'Interactive logon: Don't display last signed-in' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' DontDisplayLastUserName
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' DontDisplayLastUserName
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Interactive logon: Don't display last signed-in
        scored: true
      - id: 2.3.7.3
        description: "Ensure 'Interactive logon: Machine inactivity limit' is set to '900 or fewer second(s), but not 0' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' InactivityTimeoutSecs
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' InactivityTimeoutSecs
        tests:
          test_items:
            - flag: ""
              compare:
                op: lte
                value: 900
              set: true
            - flag: ""
              compare:
                op: noteq
                value: 0
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to '900 or fewer seconds, but not 0':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Interactive logon: Machine inactivity limit
        scored: true
      - id: 2.3.7.4
        description: "Configure 'Interactive logon: Message text for users attempting to log on' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' LegalNoticeText
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' LegalNoticeText
        tests:
          test_items:
            - flag: ""
              compare:
                op: noteq
                value: ""
              set: true
        remediation: >
          To establish the recommended configuration via GP, configure the following UI path to a value that is consistent with the security and operational requirements of your organization:
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Interactive logon: Message text for users attempting to log on
        scored: true
      - id: 2.3.7.5
        description: "Configure 'Interactive logon: Message title for users attempting to log on' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' LegalNoticeCaption
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' LegalNoticeCaption
        tests:
          test_items:
            - flag: ""
              compare:
                op: noteq
                value: ""
              set: true
        remediation: >
          To establish the recommended configuration via GP, configure the following UI path to a value that is consistent with the security and operational requirements of your organization:
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Interactive logon: Message title for users attempting to log on
        scored: true
      - id: 2.3.7.6
        description: "Ensure 'Interactive logon: Number of previous logons to cache (in case domain controller is not available)' is set to '4 or fewer logon(s)' (MS only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon' CachedLogonsCount
        tests:
          test_items:
            - flag: ""
              compare:
                op: lte
                value: 4
              set: true
            - flag: ""
              compare:
                op: noteq
                value: 0
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 4 or fewer logon(s):
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Interactive logon: Number of previous logons to cache (in case domain controller is not available)
        scored: true
      - id: 2.3.7.7
        description: "Ensure 'Interactive logon: Prompt user to change password before expiration' is set to 'between 5 and 14 days' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon' PasswordExpiryWarning
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon' PasswordExpiryWarning
        tests:
          test_items:
            - flag: ""
              compare:
                op: lte
                value: 14
              set: true
            - flag: ""
              compare:
                op: gte
                value: 5
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to a value 'between 5 and 14 days':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Interactive logon: Prompt user to change password before expiration
        scored: true
      - id: 2.3.7.8
        description: "Ensure 'Interactive logon: Require Domain Controller Authentication to unlock workstation' is set to 'Enabled' (MS only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon' ForceUnlockLogon
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To implement the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Interactive logon: Require Domain Controller Authentication to unlock workstation
        scored: true
      - id: 2.3.7.9
        description: "Ensure 'Interactive logon: Smart card removal behavior' is set to 'Lock Workstation' or higher (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon' ScRemoveOption
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon' ScRemoveOption
        tests:
          test_items:
            - flag: ""
              compare:
                op: noteq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to Lock Workstation (or, if applicable for your environment, Force Logoff or Disconnect if a Remote Desktop Services session):
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Interactive logon: Smart card removal behavior
        scored: true

  - id: 5
    description: System Services
    checks:
      - id: 5.1
        description: Ensure 'Print Spooler (Spooler)' is set to 'Disabled' (DC only) (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Spooler' Start
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "4"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\System Services\Print Spooler
        scored: true
      - id: 5.2
        description: Ensure 'Print Spooler (Spooler)' is set to 'Disabled' (MS only) (Automated)
        audittype: powershell
        audit:
          cmd:
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Spooler' Start
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "4"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\System Services\Print Spooler
        scored: true
  - id: 9.1
    description: Domain Profile
    checks:
      - id: 9.1.1
        description: "Ensure 'Windows Firewall: Domain: Firewall state' is set to 'On (recommended)' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile' EnableFirewall
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile' EnableFirewall
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'On (recommended)':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Domain Profile\Firewall state
        scored: true
      - id: 9.1.2
        description: "Ensure 'Windows Firewall: Domain: Inbound connections' is set to 'Block (default)' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile' DefaultInboundAction
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile' DefaultInboundAction
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Block (default)':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Domain Profile\Inbound connections
        scored: true
      - id: 9.1.3
        description: "Ensure 'Windows Firewall: Domain: Outbound connections' is set to 'Allow (default)' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile' DefaultOutboundAction
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile' DefaultOutboundAction
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Allow (default)':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Domain Profile\Outbound connections
        scored: true
      - id: 9.1.4
        description: "Ensure 'Windows Firewall: Domain: Settings: Display a notification' is set to 'No' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile' DisableNotifications
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile' DisableNotifications
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'No':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Domain Profile\Settings Customize\Display a notification
        scored: true
      - id: 9.1.5
        description: >
          "Ensure 'Windows Firewall: Domain: Logging: Name' is set to "
            '%SystemRoot%\System32\logfiles\firewall\domainfw.log'
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile\Logging' LogFilePath
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile\Logging' LogFilePath
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: '%SystemRoot%\System32\logfiles\firewall\domainfw.log'
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to '%SystemRoot%\System32\logfiles\firewall\domainfw.log':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Domain Profile\Logging Customize\Name
        scored: true
      - id: 9.1.6
        description: "Ensure 'Windows Firewall: Domain: Logging: Size limit (KB)' is set to '16,384 KB or greater' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile\Logging' LogFileSize
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile\Logging' LogFileSize
        tests:
          test_items:
            - flag: ""
              compare:
                op: gte
                value: 16384
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to '16,384 KB or greater':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Domain Profile\Logging Customize\Size limit (KB)
        scored: true
      - id: 9.1.7
        description: "Ensure 'Windows Firewall: Domain: Logging: Log dropped packets' is set to 'Yes' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile\Logging' LogDroppedPackets
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile\Logging' LogDroppedPackets
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Yes':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Domain Profile\Logging Customize\Log dropped packets
        scored: true
      - id: 9.1.8
        description: "Ensure 'Windows Firewall: Domain: Logging: Log successful connections' is set to 'Yes' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile\Logging' LogSuccessfulConnections
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile\Logging' LogSuccessfulConnections
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Yes':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Domain Profile\Logging Customize\Log successful connections
        scored: true
  - id: 9.2
    description: Private Profile
    checks:
      - id: 9.2.1
        description: "Ensure 'Windows Firewall: Private: Firewall state' is set to 'On (recommended)' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile' EnableFirewall
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile' EnableFirewall
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'On (recommended)':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Private Profile\Firewall state
        scored: true
      - id: 9.2.2
        description: "Ensure 'Windows Firewall: Private: Inbound connections' is set to 'Block (default)' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile' DefaultInboundAction
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile' DefaultInboundAction
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Block (default)':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Private Profile\Inbound connections
        scored: true
      - id: 9.2.3
        description: "Ensure 'Windows Firewall: Private: Outbound connections' is set to 'Allow (default)' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile' DefaultOutboundAction
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile' DefaultOutboundAction
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Allow (default)':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Private Profile\Outbound connections
        scored: true
      - id: 9.2.4
        description: "Ensure 'Windows Firewall: Private: Settings: Display a notification' is set to 'No' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile' DisableNotifications
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile' DisableNotifications
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'No':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Private Profile\Settings Customize\Display a notification
        scored: true
      - id: 9.2.5
        description: >
          "Ensure 'Windows Firewall: Private: Logging: Name' is set to "
            '%SystemRoot%\System32\logfiles\firewall\privatefw.log' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile\Logging' LogFilePath
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile\Logging' LogFilePath
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: '%SystemRoot%\System32\logfiles\firewall\privatefw.log'
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to '%SystemRoot%\System32\logfiles\firewall\privatefw.log':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Private Profile\Logging Customize\Name
        scored: true
      - id: 9.2.6
        description: "Ensure 'Windows Firewall: Private: Logging: Size limit (KB)' is set to '16,384 KB or greater' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile\Logging' LogFileSize
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile\Logging' LogFileSize
        tests:
          test_items:
            - flag: ""
              compare:
                op: gte
                value: 16384
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to '16,384 KB or greater':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Private Profile\Logging Customize\Size limit (KB)
        scored: true
      - id: 9.2.7
        description: "Ensure 'Windows Firewall: Private: Logging: Log dropped packets' is set to 'Yes' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile\Logging' LogDroppedPackets
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile\Logging' LogDroppedPackets
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Yes':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Private Profile\Logging Customize\Log dropped packets
        scored: true
      - id: 9.2.8
        description: "Ensure 'Windows Firewall: Private: Logging: Log successful connections' is set to 'Yes' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile\Logging' LogSuccessfulConnections
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile\Logging' LogSuccessfulConnections
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Yes':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Private Profile\Logging Customize\Log successful connections
        scored: true
  - id: 9.3
    description: Public Profile
    checks:
      - id: 9.3.1
        description: "Ensure 'Windows Firewall: Public: Firewall state' is set to 'On (recommended)' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile' EnableFirewall
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile' EnableFirewall
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'On (recommended)':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Public Profile\Firewall state
        scored: true
      - id: 9.3.2
        description: "Ensure 'Windows Firewall: Public: Inbound connections' is set to 'Block (default)' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile' DefaultInboundAction
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile' DefaultInboundAction
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Block (default)':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Public Profile\Inbound connections
        scored: true
      - id: 9.3.3
        description: "Ensure 'Windows Firewall: Public: Outbound connections' is set to 'Allow (default)' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile' DefaultOutboundAction
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile' DefaultOutboundAction
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Allow (default)':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Public Profile\Outbound connections
        scored: true
      - id: 9.3.4
        description: "Ensure 'Windows Firewall: Public: Settings: Display a notification' is set to 'No' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile' DisableNotifications
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile' DisableNotifications
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'No':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Public Profile\Settings Customize\Display a notification
        scored: true
      - id: 9.3.5
        description: "Ensure 'Windows Firewall: Public: Settings: Apply local firewall rules' is set to 'No' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile' AllowLocalPolicyMerge
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile' AllowLocalPolicyMerge
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'No':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Public Profile\Settings Customize\Apply local firewall rules
        scored: true
      - id: 9.3.6
        description: "Ensure 'Windows Firewall: Public: Settings: Apply local connection security rules' is set to 'No' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile' AllowLocalIPsecPolicyMerge
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile' AllowLocalIPsecPolicyMerge
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'No':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Public Profile\Settings Customize\Apply local connection security rules
        scored: true
      - id: 9.3.7
        description: >
          "Ensure 'Windows Firewall: Public: Logging: Name' is set to "
            '%SystemRoot%\System32\logfiles\firewall\publicfw.log' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile\Logging' LogFilePath
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile\Logging' LogFilePath
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: '%SystemRoot%\System32\logfiles\firewall\publicfw.log'
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to '%SystemRoot%\System32\logfiles\firewall\publicfw.log':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Public Profile\Logging Customize\Name
        scored: true
      - id: 9.3.8
        description: "Ensure 'Windows Firewall: Public: Logging: Size limit (KB)' is set to '16,384 KB or greater' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile\Logging' LogFileSize
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile\Logging' LogFileSize
        tests:
          test_items:
            - flag: ""
              compare:
                op: gte
                value: 16384
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to '16,384 KB or greater':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Public Profile\Logging Customize\Size limit (KB)
        scored: true
      - id: 9.3.9
        description: "Ensure 'Windows Firewall: Public: Logging: Log dropped packets' is set to 'Yes' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile\Logging' LogDroppedPackets
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile\Logging' LogDroppedPackets
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Yes':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Public Profile\Logging Customize\Log dropped packets
        scored: true
      - id: 9.3.10
        description: "Ensure 'Windows Firewall: Public: Logging: Log successful connections' is set to 'Yes' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile\Logging' LogSuccessfulConnections
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile\Logging' LogSuccessfulConnections
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Yes':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Public Profile\Logging Customize\Log successful connections
        scored: true

  - id: 17.1
    description: Account Logon
    checks:
      - id: 17.1.1
        description: "Ensure 'Audit Credential Validation' is set to 'Success and Failure' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Credential Validation" | Select-String -Pattern 'Credential Validation' ) -replace ".*Credential Validation\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Credential Validation" | Select-String -Pattern 'Credential Validation' ) -replace ".*Credential Validation\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success and Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success' and 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Account Logon\Audit Credential Validation
        scored: true
      - id: 17.1.2
        description: "Ensure 'Audit Kerberos Authentication Service' is set to 'Success and Failure' (DC Only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Kerberos Authentication Service" | Select-String -Pattern 'Kerberos Authentication Service' ) -replace ".*Kerberos Authentication Service\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success and Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success' and 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Account Logon\Audit Kerberos Authentication Service
        scored: true
      - id: 17.1.3
        description: "Ensure 'Audit Kerberos Service Ticket Operations' is set to 'Success and Failure' (DC Only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Kerberos Service Ticket Operations" | Select-String -Pattern 'Kerberos Service Ticket Operations' ) -replace ".*Kerberos Service Ticket Operations\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success and Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success' and 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Account Logon\Audit Kerberos Service Ticket Operations
        scored: true
  - id: 17.2
    description: Account Management
    checks:
      - id: 17.2.1
        description: "Ensure 'Audit Application Group Management' is set to 'Success and Failure' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Application Group Management" | Select-String -Pattern 'Application Group Management' ) -replace ".*Application Group Management\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Application Group Management" | Select-String -Pattern 'Application Group Management' ) -replace ".*Application Group Management\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success and Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success' and 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Account Management\Audit Application Group Management
        scored: true
      - id: 17.2.2
        description: "Ensure 'Audit Computer Account Management' is set to include 'Success' (DC only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Computer Account Management" | Select-String -Pattern 'Computer Account Management' ) -replace ".*Computer Account Management\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Account Management\Audit Computer Account Management
        scored: true
      - id: 17.2.3
        description: "Ensure 'Audit Distribution Group Management' is set to include 'Success' (DC only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Distribution Group Management" | Select-String -Pattern 'Distribution Group Management' ) -replace ".*Distribution Group Management\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Account Management\Audit Distribution Group Management
        scored: true
      - id: 17.2.4
        description: "Ensure 'Audit Other Account Management Events' is set to include 'Success' (DC only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Other Account Management Events" | Select-String -Pattern 'Other Account Management Events' ) -replace ".*Other Account Management Events\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Account Management\Audit Other Account Management Events
        scored: true
      - id: 17.2.5
        description: "Ensure 'Audit Security Group Management' is set to include 'Success' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Security Group Management" | Select-String -Pattern 'Security Group Management' ) -replace ".*Security Group Management\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Security Group Management" | Select-String -Pattern 'Security Group Management' ) -replace ".*Security Group Management\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Account Management\Audit Security Group Management
        scored: true
      - id: 17.2.6
        description: "Ensure 'Audit User Account Management' is set to 'Success and Failure' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"User Account Management" | Select-String -Pattern 'User Account Management' ) -replace ".*User Account Management\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"User Account Management" | Select-String -Pattern 'User Account Management' ) -replace ".*User Account Management\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success and Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success' and 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Account Management\Audit User Account Management
        scored: true
  - id: 17.3
    description: Detailed Tracking
    checks:
      - id: 17.3.1
        description: "Ensure 'Audit PNP Activity' is set to include 'Success' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Plug and Play Events" | Select-String -Pattern 'Plug and Play Events' ) -replace ".*Plug and Play Events\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Plug and Play Events" | Select-String -Pattern 'Plug and Play Events' ) -replace ".*Plug and Play Events\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Detailed Tracking\Audit PNP Activity
        scored: true
      - id: 17.3.2
        description: "Ensure 'Audit Process Creation' is set to include 'Success' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Process Creation" | Select-String -Pattern 'Process Creation' ) -replace ".*Process Creation\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Process Creation" | Select-String -Pattern 'Process Creation' ) -replace ".*Process Creation\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Detailed Tracking\Audit Process Creation
        scored: true
  - id: 17.4
    description: DS Access
    checks:
      - id: 17.4.1
        description: "Ensure 'Audit Directory Service Access' is set to include 'Failure' (DC only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Directory Service Access" | Select-String -Pattern 'Directory Service Access' ) -replace ".*Directory Service Access\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\DS Access\Audit Directory Service Access
        scored: true
      - id: 17.4.2
        description: "Ensure 'Audit Directory Service Changes' is set to include 'Success' (DC only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Directory Service Changes" | Select-String -Pattern 'Directory Service Changes' ) -replace ".*Directory Service Changes\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\DS Access\Audit Directory Service Changes
        scored: true
  - id: 17.5
    description: Logon/Logoff
    checks:
      - id: 17.5.1
        description: "Ensure 'Audit Account Lockout' is set to include 'Failure' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Account Lockout" | Select-String -Pattern 'Account Lockout' ) -replace ".*Account Lockout\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Account Lockout" | Select-String -Pattern 'Account Lockout' ) -replace ".*Account Lockout\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Logon/Logoff\Audit Account Lockout
        scored: true
      - id: 17.5.2
        description: "Ensure 'Audit Group Membership' is set to include 'Success' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Group Membership" | Select-String -Pattern 'Group Membership' ) -replace ".*Group Membership\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Group Membership" | Select-String -Pattern 'Group Membership' ) -replace ".*Group Membership\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Logon/Logoff\Audit Group Membership
        scored: true
      - id: 17.5.3
        description: "Ensure 'Audit Logoff' is set to include 'Success' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Logoff" | Select-String -Pattern ' Logoff' ) -replace ".*Logoff\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Logoff" | Select-String -Pattern ' Logoff' ) -replace ".*Logoff\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Logon/Logoff\Audit Logoff
        scored: true
      - id: 17.5.4
        description: "Ensure 'Audit Logon' is set to 'Success and Failure' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Logon" | Select-String -Pattern 'Logon ' ) -replace ".*Logon\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Logon" | Select-String -Pattern 'Logon ' ) -replace ".*Logon\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success and Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success' and 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Logon/Logoff\Audit Logon
        scored: true
      - id: 17.5.5
        description: "Ensure 'Audit Other Logon/Logoff Events' is set to 'Success and Failure' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Other Logon/Logoff Events" | Select-String -Pattern 'Other Logon/Logoff Events' ) -replace ".*Other Logon/Logoff Events\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Other Logon/Logoff Events" | Select-String -Pattern 'Other Logon/Logoff Events' ) -replace ".*Other Logon/Logoff Events\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success and Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success' and 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Logon/Logoff\Audit Other Logon/Logoff Events
        scored: true
      - id: 17.5.6
        description: "Ensure 'Audit Special Logon' is set to include 'Success' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Special Logon" | Select-String -Pattern 'Special Logon' ) -replace ".*Special Logon\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Special Logon" | Select-String -Pattern 'Special Logon' ) -replace ".*Special Logon\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Logon/Logoff\Audit Special Logon
        scored: true
  - id: 17.6
    description: Object Access
    checks:
      - id: 17.6.1
        description: "Ensure 'Audit Detailed File Share' is set to include 'Failure' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Detailed File Share" | Select-String -Pattern 'Detailed File Share' ) -replace ".*Detailed File Share\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Detailed File Share" | Select-String -Pattern 'Detailed File Share' ) -replace ".*Detailed File Share\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Object Access\Audit Detailed File Share
        scored: true
      - id: 17.6.2
        description: "Ensure 'Audit File Share' is set to 'Success and Failure' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"File Share" | Select-String -Pattern 'File Share' ) -replace ".*File Share\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"File Share" | Select-String -Pattern 'File Share' ) -replace ".*File Share\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success and Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success' and 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Object Access\Audit File Share
        scored: true
      - id: 17.6.3
        description: "Ensure 'Audit Other Object Access Events' is set to 'Success and Failure' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Other Object Access Events" | Select-String -Pattern 'Other Object Access Events' ) -replace ".*Other Object Access Events\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Other Object Access Events" | Select-String -Pattern 'Other Object Access Events' ) -replace ".*Other Object Access Events\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success and Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success' and 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Object Access\Audit Other Object Access Events
        scored: true
      - id: 17.6.4
        description: "Ensure 'Audit Removable Storage' is set to 'Success and Failure' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Removable Storage" | Select-String -Pattern 'Removable Storage' ) -replace ".*Removable Storage\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Removable Storage" | Select-String -Pattern 'Removable Storage' ) -replace ".*Removable Storage\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success and Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success' and 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Object Access\Audit Removable Storage
        scored: true
  - id: 17.7
    description: Policy Change
    checks:
      - id: 17.7.1
        description: "Ensure 'Audit Audit Policy Change' is set to include 'Success' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Audit Policy Change" | Select-String -Pattern 'Audit Policy Change' ) -replace ".*Audit Policy Change\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Audit Policy Change" | Select-String -Pattern 'Audit Policy Change' ) -replace ".*Audit Policy Change\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Policy Change\Audit Audit Policy Change
        scored: true
      - id: 17.7.2
        description: "Ensure 'Audit Authentication Policy Change' is set to include 'Success' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Audit Policy Change" | Select-String -Pattern 'Audit Policy Change' ) -replace ".*Audit Policy Change\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Audit Policy Change" | Select-String -Pattern 'Audit Policy Change' ) -replace ".*Audit Policy Change\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Policy Change\Audit Authentication Policy Change
        scored: true
      - id: 17.7.3
        description: "Ensure 'Audit Authorization Policy Change' is set to include 'Success' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Authorization Policy Change" | Select-String -Pattern 'Authorization Policy Change' ) -replace ".*Authorization Policy Change\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Authorization Policy Change" | Select-String -Pattern 'Authorization Policy Change' ) -replace ".*Authorization Policy Change\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Policy Change\Audit Authorization Policy Change
        scored: true
      - id: 17.7.4
        description: "Ensure 'Audit MPSSVC Rule-Level Policy Change' is set to 'Success and Failure' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"MPSSVC Rule-Level Policy Change" | Select-String -Pattern 'MPSSVC Rule-Level Policy Change' ) -replace ".*MPSSVC Rule-Level Policy Change\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"MPSSVC Rule-Level Policy Change" | Select-String -Pattern 'MPSSVC Rule-Level Policy Change' ) -replace ".*MPSSVC Rule-Level Policy Change\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success and Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success' and 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Policy Change\Audit MPSSVC Rule-Level Policy Change
        scored: true
      - id: 17.7.5
        description: "Ensure 'Audit Other Policy Change Events' is set to include 'Failure' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Other Policy Change Events" | Select-String -Pattern 'Other Policy Change Events' ) -replace ".*Other Policy Change Events\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Other Policy Change Events" | Select-String -Pattern 'Other Policy Change Events' ) -replace ".*Other Policy Change Events\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Policy Change\Audit Other Policy Change Events
        scored: true
  - id: 17.8
    description: Privilege Use
    checks:
      - id: 17.8.1
        description: "Ensure 'Audit Sensitive Privilege Use' is set to 'Success and Failure' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Sensitive Privilege Use" | Select-String -Pattern 'Sensitive Privilege Use' ) -replace ".*Sensitive Privilege Use\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Sensitive Privilege Use" | Select-String -Pattern 'Sensitive Privilege Use' ) -replace ".*Sensitive Privilege Use\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success and Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success' and 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Privilege Use\Audit Sensitive Privilege Use
        scored: true
  - id: 17.9
    description: System
    checks:
      - id: 17.9.1
        description: "Ensure 'Audit IPsec Driver' is set to 'Success and Failure' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"IPsec Driver" | Select-String -Pattern 'IPsec Driver' ) -replace ".*IPsec Driver\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"IPsec Driver" | Select-String -Pattern 'IPsec Driver' ) -replace ".*IPsec Driver\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success and Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success' and 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\System\Audit IPsec Driver
        scored: true
      - id: 17.9.2
        description: "Ensure 'Audit Other System Events' is set to 'Success and Failure' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Other System Events" | Select-String -Pattern 'Other System Events' ) -replace ".*Other System Events\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Other System Events" | Select-String -Pattern 'Other System Events' ) -replace ".*Other System Events\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success and Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success' and 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\System\Audit Other System Events
        scored: true
      - id: 17.9.3
        description: "Ensure 'Audit Security State Change' is set to include 'Success' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Security State Change" | Select-String -Pattern 'Security State Change' ) -replace ".*Security State Change\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Security State Change" | Select-String -Pattern 'Security State Change' ) -replace ".*Security State Change\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\System\Audit Security State Change
        scored: true
      - id: 17.9.4
        description: "Ensure 'Audit Security System Extension' is set to include 'Success' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Security System Extension" | Select-String -Pattern 'Security System Extension' ) -replace ".*Security System Extension\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Security System Extension" | Select-String -Pattern 'Security System Extension' ) -replace ".*Security System Extension\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\System\Audit Security System Extension
        scored: true
      - id: 17.9.5
        description: "Ensure 'Audit System Integrity' is set to 'Success and Failure' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"System Integrity" | Select-String -Pattern 'System Integrity' ) -replace ".*System Integrity\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"System Integrity" | Select-String -Pattern 'System Integrity' ) -replace ".*System Integrity\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success and Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success' and 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\System\Audit System Integrity
        scored: true
